<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DitoBanx Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
            min-height: 100vh;
        }
        header {
            background-color: black;
            color: orange;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .game-container {
            max-width: 600px;
            margin-top: 30px;
            text-align: center;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            background-color: white;
            width: 90%;
        }
        .question {
            font-size: 22px;
            margin: 25px 0;
            color: #222;
            font-weight: bold;
            padding: 10px;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        .answers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        .answers button {
            padding: 15px;
            border: none;
            background-color: #ffa500;
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
            font-weight: 600;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        .answers button:hover {
            background-color: #ff8c00;
            transform: scale(1.05);
            box-shadow: 0 5px 12px rgba(0,0,0,0.15);
        }
        .stats-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }
        .lives {
            font-size: 24px;
        }
        .xp-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        .xp-text {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        .xp-bar {
            width: 150px;
            height: 15px;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
        }
        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff8c00, #ffa500);
            width: 0%;
            transition: width 0.5s;
        }
        #start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 100px;
            background-color: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            width: 80%;
            max-width: 500px;
        }
        #start-screen h2 {
            color: #ff8c00;
            margin-bottom: 20px;
        }
        #start-screen input {
            padding: 12px;
            margin-top: 15px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #ddd;
            width: 80%;
            outline: none;
        }
        #start-screen input:focus {
            border-color: #ffa500;
            box-shadow: 0 0 5px rgba(255, 165, 0, 0.3);
        }
        .btn {
            margin-top: 20px;
            padding: 12px 25px;
            background-color: black;
            color: orange;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background-color: #333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .progress-bar {
            margin-top: 20px;
            width: 100%;
            background-color: #eee;
            border-radius: 12px;
            overflow: hidden;
            height: 15px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #ffa500, #ff8c00);
            width: 0%;
            transition: width 0.5s;
        }
        .result-screen {
            text-align: center;
            padding: 20px;
        }
        .result-screen h2 {
            color: #ff8c00;
            margin-bottom: 15px;
        }
        .result-info {
            font-size: 18px;
            margin-bottom: 20px;
        }
        .score {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 15px 0;
        }
        .restart-btn {
            display: inline-block;
            margin-top: 20px;
        }
        .user-profile {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #f0f0f0;
            border-radius: 12px;
            padding: 10px 15px;
            margin-bottom: 20px;
        }
        .user-info {
            display: flex;
            align-items: center;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: #ffa500;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        .user-name {
            font-weight: 600;
            color: #333;
        }
        .total-xp-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }
        .total-xp-text {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
            text-align: center;
        }
        .total-xp-bar {
            width: 100%;
            height: 15px;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .total-xp-progress {
            height: 100%;
            background: linear-gradient(90deg, #6a5acd, #9370db);
            width: 0%;
            transition: width 0.5s;
        }
        .turn-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }
        .level-badge {
            background-color: #9370db;
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 10px;
        }
        @media (max-width: 600px) {
            .answers {
                grid-template-columns: 1fr;
            }
            .game-container {
                padding: 20px;
            }

       .home-btn {
    position: absolute;
    top: 20px;
    left: 20px;
    padding: 8px 15px;
    background-color: black;
    color: orange;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    z-index: 100;
}
.home-btn:hover {
    background-color: #333;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
    </style>
</head>
<body>

    <header>DitoBanx Game</header>
    <button id="home-button" class="home-btn" style="display:none;" onclick="goHome()">Volver al inicio</button>

    <div id="start-screen">
        <h2>¡Bienvenido al juego!</h2>
        <p>Aprende sobre finanzas y criptomonedas mientras te diviertes</p>
        <input type="text" id="player-name" placeholder="Ingresa tu nombre">
        <input type="email" id="player-email" placeholder="Ingresa tu email (opcional)">
        <button class="btn" onclick="startGame()">Comenzar</button>
    </div>

    <div class="game-container" id="game-container" style="display:none;">
        <div class="user-profile">
            <div class="user-info">
                <div class="user-avatar" id="user-avatar"></div>
                <div>
                    <div class="user-name" id="user-name"></div>
                    <div id="user-email" style="font-size: 12px; color: #777;"></div>
                </div>
            </div>
            <div>
                <span class="level-badge" id="level-badge">Nivel 1</span>
            </div>
        </div>

        <div class="total-xp-container">
            <div class="total-xp-text">XP Total: <span id="total-xp-value">0</span></div>
            <div class="total-xp-bar">
                <div class="total-xp-progress" id="total-xp-progress"></div>
            </div>
        </div>

        <div class="turn-info">
            <span>Turno: <span id="current-turn">1</span>/<span id="total-turns">3</span></span>
            <span>Preguntas: <span id="current-question-turn">1</span>/5</span>
        </div>

        <div class="stats-container">
            <div class="lives" id="lives">❤️❤️❤️</div>
            <div class="xp-container">
                <div class="xp-text">XP: <span id="xp-value">0</span></div>
                <div class="xp-bar">
                    <div class="xp-progress" id="xp-progress"></div>
                </div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>

        <div class="question" id="question">Pregunta aquí</div>
        <div class="answers" id="answers"></div>

        <div id="result-screen" class="result-screen" style="display:none;">
            <h2 id="result-title">Resultados</h2>
            <div class="result-info" id="result-info"></div>
            <div class="score" id="final-score"></div>
            <button class="btn restart-btn" onclick="restartGame()">Jugar de nuevo</button>
        </div>

        <div id="turn-complete" class="result-screen" style="display:none;">
            <h2>¡Turno completado!</h2>
            <div class="result-info" id="turn-info"></div>
            <div class="score" id="turn-score"></div>
            <button class="btn restart-btn" onclick="nextTurn()">Siguiente turno</button>
        </div>
    </div>

<script>
    const questions = [
        // Preguntas originales
        {
            question: "¿Qué es una cartera de criptomonedas?",
            options: ["Un lugar para guardar claves privadas", "Un banco digital", "Una tarjeta de crédito", "Un cajero automático"],
            answer: "Un lugar para guardar claves privadas"
        },
        {
            question: "¿Qué es una cartera fría?",
            options: ["Una cartera conectada a internet", "Una cartera desconectada de internet", "Una aplicación móvil", "Un tipo de préstamo"],
            answer: "Una cartera desconectada de internet"
        },
        {
            question: "¿Cuál es el suministro máximo de Bitcoin?",
            options: ["100 millones", "21 millones", "1 millón", "50 millones"],
            answer: "21 millones"
        },
        {
            question: "¿Qué es un fondo de emergencia?",
            options: ["Un préstamo rápido", "Dinero ahorrado para imprevistos", "Una inversión en criptos", "Un pago de tarjeta"],
            answer: "Dinero ahorrado para imprevistos"
        },
        {
            question: "¿Qué es una seed phrase?",
            options: ["Una contraseña temporal", "Una serie de palabras para recuperar una cartera", "Una app de trading", "Un código QR"],
            answer: "Una serie de palabras para recuperar una cartera"
        },
        // Preguntas adicionales generadas
        {
            question: "¿Qué es una stablecoin?",
            options: ["Una criptomoneda que mantiene un valor estable", "Una criptomoneda altamente volátil", "Un tipo de préstamo bancario", "Una acción financiera"],
            answer: "Una criptomoneda que mantiene un valor estable"
        },
        {
            question: "¿Qué significa diversificar tus inversiones?",
            options: ["Invertir en un solo activo", "Repartir tus inversiones en diferentes activos", "Comprar solo criptomonedas", "Guardar todo en efectivo"],
            answer: "Repartir tus inversiones en diferentes activos"
        },
        {
            question: "¿Qué es un NFT?",
            options: ["Un archivo PDF", "Un token no fungible", "Un tipo de préstamo", "Un banco digital"],
            answer: "Un token no fungible"
        },
        {
            question: "¿Qué es la blockchain?",
            options: ["Una base de datos distribuida y segura", "Una tarjeta de crédito", "Una tienda en línea", "Un tipo de inversión tradicional"],
            answer: "Una base de datos distribuida y segura"
        },
        {
            question: "¿Qué significa ahorrar?",
            options: ["Gastar más de lo que ganas", "Reservar una parte de tus ingresos", "Invertir en acciones", "Usar solo tarjetas de crédito"],
            answer: "Reservar una parte de tus ingresos"
        },
        {
            question: "¿Qué es la inflación?",
            options: ["El aumento general de precios", "Una criptomoneda", "Un ahorro protegido", "Una aplicación financiera"],
            answer: "El aumento general de precios"
        },
        // Más preguntas
        {
            question: "¿Qué es el interés compuesto?",
            options: ["Interés que se calcula solo sobre el capital inicial", "Interés que se calcula sobre el capital más los intereses acumulados", "Un tipo de impuesto", "Una comisión bancaria"],
            answer: "Interés que se calcula sobre el capital más los intereses acumulados"
        },
        {
            question: "¿Qué es la minería de criptomonedas?",
            options: ["Extraer metales preciosos", "Proceso de validar transacciones en una blockchain", "Crear nuevas criptomonedas sin verificación", "Comprar criptomonedas a bajo precio"],
            answer: "Proceso de validar transacciones en una blockchain"
        },
        {
            question: "¿Qué es un contrato inteligente?",
            options: ["Un contrato firmado electrónicamente", "Un programa que se ejecuta automáticamente en la blockchain", "Un seguro financiero", "Un préstamo de bajo interés"],
            answer: "Un programa que se ejecuta automáticamente en la blockchain"
        },
        {
            question: "¿Qué es DeFi?",
            options: ["Finanzas descentralizadas", "Un tipo de criptomoneda", "Un banco digital", "Finanzas dependientes"],
            answer: "Finanzas descentralizadas"
        }
    ];

    let currentQuestion = 0;
    let lives = 3;
    let xp = 0;
    let totalXP = 0;
    let playerName = "";
    let playerEmail = "";
    let userLevel = 1;
    const MAX_XP = 100;
    const QUESTIONS_PER_TURN = 5;
    const TOTAL_TURNS = 3;
    let currentTurn = 1;
    let currentQuestionInTurn = 1;
    let correctAnswers = 0;
    let turnCorrectAnswers = 0;

    function startGame() {
    // Obtener los valores del jugador o usar los guardados
    const inputName = document.getElementById('player-name').value.trim();
    const inputEmail = document.getElementById('player-email').value.trim();

    if (inputName !== "") {
        playerName = inputName;
        playerEmail = inputEmail;
    } else if (!loadGameState()) {
        // Si no hay nombre y no hay estado guardado
        return alert("Por favor, ingresa tu nombre.");
    }

    document.getElementById('start-screen').style.display = "none";
    document.getElementById('game-container').style.display = "block";
    document.getElementById('result-screen').style.display = "none";
    document.getElementById('turn-complete').style.display = "none";
    document.getElementById('home-button').style.display = "block";

    // Configurar información de usuario
    document.getElementById('user-name').innerText = playerName;
    document.getElementById('user-email').innerText = playerEmail || "";
    document.getElementById('user-avatar').innerText = playerName.charAt(0).toUpperCase();

    // Configurar información de turno
    document.getElementById('current-turn').innerText = currentTurn;
    document.getElementById('total-turns').innerText = TOTAL_TURNS;
    document.getElementById('current-question-turn').innerText = currentQuestionInTurn;

    // Actualizar todas las estadísticas
    updateXP();
    updateTotalXP();
    updateLives();
    updateLevel();
    updateProgress();

    // Si es una partida nueva, mezclar las preguntas
    if (currentQuestion === 0) {
        shuffleArray(questions);
    }

    loadQuestion();
}

    function resetGame() {
        // Mezclar las preguntas al inicio del juego
        shuffleArray(questions);

        currentQuestion = 0;
        lives = 3;
        xp = 0;
        totalXP = 0;
        correctAnswers = 0;
        currentTurn = 1;
        currentQuestionInTurn = 1;
        turnCorrectAnswers = 0;
        userLevel = 1;

        updateXP();
        updateTotalXP();
        updateLives();
        updateLevel();

        document.getElementById('current-turn').innerText = currentTurn;
        document.getElementById('current-question-turn').innerText = currentQuestionInTurn;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function restartGame() {
        // Mostrar la interfaz del juego nuevamente
        document.getElementById('question').style.display = "block";
        document.getElementById('answers').style.display = "grid";
        document.getElementById('result-screen').style.display = "none";
        document.getElementById('turn-complete').style.display = "none";

        // Reiniciar todas las variables del juego
        resetGame();

        // Cargar la primera pregunta
        loadQuestion();
    }

    function nextTurn() {
        currentTurn++;
        currentQuestionInTurn = 1;
        xp = 0;
        turnCorrectAnswers = 0;
        lives = 3;

        document.getElementById('current-turn').innerText = currentTurn;
        document.getElementById('current-question-turn').innerText = currentQuestionInTurn;
        updateXP();
        updateLives();

        document.getElementById('turn-complete').style.display = "none";
        document.getElementById('question').style.display = "block";
        document.getElementById('answers').style.display = "grid";

        loadQuestion();
        saveGameState();
    }

    function loadQuestion() {
        if (lives === 0) {
            showResults(false);
            return;
        }

        if (currentTurn > TOTAL_TURNS) {
            showResults(true);
            return;
        }

        if (currentQuestionInTurn > QUESTIONS_PER_TURN) {
            showTurnComplete();
            return;
        }

        // Asegurar que no nos quedemos sin preguntas
        if (currentQuestion >= questions.length) {
            // Si nos quedamos sin preguntas, volver a mezclar
            shuffleArray(questions);
            currentQuestion = 0;
        }

        const q = questions[currentQuestion];
        document.getElementById('question').innerText = q.question;
        const answersDiv = document.getElementById('answers');
        answersDiv.innerHTML = "";

        // Shuffle options
        const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);

        shuffledOptions.forEach(option => {
            const btn = document.createElement('button');
            btn.innerText = option;
            btn.onclick = () => checkAnswer(option);
            answersDiv.appendChild(btn);
        });

        updateProgress();
    }

    function checkAnswer(selected) {
        const correct = selected === questions[currentQuestion].answer;

        if (correct) {
            xp += 20;
            totalXP += 20;
            correctAnswers++;
            turnCorrectAnswers++;
            updateXP();
            updateTotalXP();
            updateLevel();
            saveGameState();

            // Create a temporary "Correct!" message
            const feedback = document.createElement('div');
            feedback.innerText = "¡Correcto! +20 XP";
            feedback.style.color = "green";
            feedback.style.fontWeight = "bold";
            feedback.style.fontSize = "18px";
            feedback.style.margin = "10px 0";
            document.getElementById('answers').appendChild(feedback);

            setTimeout(() => {
                currentQuestion++;
                currentQuestionInTurn++;
                document.getElementById('current-question-turn').innerText = currentQuestionInTurn;
                loadQuestion();
            }, 1000);
        } else {
            lives--;
            updateLives();

            // Create a temporary "Incorrect!" message
            const feedback = document.createElement('div');
            feedback.innerText = "¡Incorrecto! -1 ❤️";
            feedback.style.color = "red";
            feedback.style.fontWeight = "bold";
            feedback.style.fontSize = "18px";
            feedback.style.margin = "10px 0";
            document.getElementById('answers').appendChild(feedback);

            setTimeout(() => {
                currentQuestion++;
                currentQuestionInTurn++;
                document.getElementById('current-question-turn').innerText = currentQuestionInTurn;
                loadQuestion();
            }, 1000);
        }
    }

    function updateLives() {
        let hearts = "";
        for (let i = 0; i < lives; i++) {
            hearts += "❤️";
        }
        document.getElementById('lives').innerText = hearts;
    }

    function updateXP() {
        document.getElementById('xp-value').innerText = xp;
        const xpPercent = (xp / MAX_XP) * 100;
        document.getElementById('xp-progress').style.width = `${Math.min(xpPercent, 100)}%`;
    }

    function updateTotalXP() {
        document.getElementById('total-xp-value').innerText = totalXP;

        // Para la barra de progreso total asumimos que 300 XP es el máximo (para nivel 3)
        const totalXpPercent = (totalXP / 300) * 100;
        document.getElementById('total-xp-progress').style.width = `${Math.min(totalXpPercent, 100)}%`;
    }

    function updateLevel() {
        // Sistema simple de niveles
        if (totalXP >= 200) {
            userLevel = 3;
        } else if (totalXP >= 100) {
            userLevel = 2;
        } else {
            userLevel = 1;
        }

        document.getElementById('level-badge').innerText = `Nivel ${userLevel}`;
    }

    function updateProgress() {
        const progressPercent = ((currentQuestionInTurn - 1) / QUESTIONS_PER_TURN) * 100;
        document.getElementById('progress').style.width = `${progressPercent}%`;
    }

    function showTurnComplete() {
        const turnComplete = document.getElementById('turn-complete');
        const turnInfo = document.getElementById('turn-info');
        const turnScore = document.getElementById('turn-score');

        turnComplete.style.display = "block";
        document.getElementById('question').style.display = "none";
        document.getElementById('answers').style.display = "none";

        turnInfo.innerText = `Has completado el turno ${currentTurn} de ${TOTAL_TURNS}.`;
        turnScore.innerText = `Puntuación del turno: ${xp} XP | Respuestas correctas: ${turnCorrectAnswers}/${QUESTIONS_PER_TURN}`;
    }

    function showResults(completed) {
        const resultScreen = document.getElementById('result-screen');
        saveGameState();
        const resultTitle = document.getElementById('result-title');
        const resultInfo = document.getElementById('result-info');
        const finalScore = document.getElementById('final-score');

        resultScreen.style.display = "block";
        document.getElementById('question').style.display = "none";
        document.getElementById('answers').style.display = "none";
        document.getElementById('turn-complete').style.display = "none";

        if (completed) {
            resultTitle.innerText = "¡Felicidades!";
            resultInfo.innerText = `Has completado todos los turnos, ${playerName}. Tus conocimientos en finanzas y criptomonedas son impresionantes.`;
        } else {
            resultTitle.innerText = "Juego terminado";
            resultInfo.innerText = `Has agotado todas tus vidas, ${playerName}. Inténtalo de nuevo para mejorar tu puntuación.`;
        }

        const totalPossibleQuestions = QUESTIONS_PER_TURN * TOTAL_TURNS;
        finalScore.innerText = `Puntuación final: ${totalXP} XP | Nivel: ${userLevel} | Respuestas correctas: ${correctAnswers}/${currentQuestion}`;
    }
      // Función para guardar la experiencia en localStorage
function saveGameState() {
    const gameState = {
        playerName: playerName,
        playerEmail: playerEmail,
        totalXP: totalXP,
        userLevel: userLevel,
        currentTurn: currentTurn,
        currentQuestionInTurn: currentQuestionInTurn,
        lives: lives,
        xp: xp,
        correctAnswers: correctAnswers,
        turnCorrectAnswers: turnCorrectAnswers
    };
    localStorage.setItem('ditobanxGameState', JSON.stringify(gameState));
}

// Función para cargar la experiencia de localStorage
function loadGameState() {
    const savedState = localStorage.getItem('ditobanxGameState');
    if (savedState) {
        const gameState = JSON.parse(savedState);
        playerName = gameState.playerName;
        playerEmail = gameState.playerEmail;
        totalXP = gameState.totalXP;
        userLevel = gameState.userLevel;
        currentTurn = gameState.currentTurn;
        currentQuestionInTurn = gameState.currentQuestionInTurn;
        lives = gameState.lives;
        xp = gameState.xp;
        correctAnswers = gameState.correctAnswers;
        turnCorrectAnswers = gameState.turnCorrectAnswers;

        return true;
    }
    return false;
}

// Función para volver a la pantalla de inicio
function goHome() {
    // Guardar el estado actual antes de volver al inicio
    saveGameState();

    // Mostrar la pantalla de inicio y ocultar el juego
    document.getElementById('start-screen').style.display = "flex";
    document.getElementById('game-container').style.display = "none";
    document.getElementById('home-button').style.display = "none";

    // Actualizar el texto del botón de inicio para reflejar continuar/nuevo juego
    const startButton = document.querySelector('#start-screen .btn');
    startButton.innerText = "Continuar juego";

    // Añadir un botón para empezar un juego nuevo
    if (!document.getElementById('new-game-btn')) {
        const newGameBtn = document.createElement('button');
        newGameBtn.id = 'new-game-btn';
        newGameBtn.className = 'btn';
        newGameBtn.style.backgroundColor = '#666';
        newGameBtn.style.marginTop = '10px';
        newGameBtn.innerText = "Nuevo juego";
        newGameBtn.onclick = function() {
            localStorage.removeItem('ditobanxGameState');
            window.location.reload();
        };
        document.getElementById('start-screen').appendChild(newGameBtn);
    }
}
</script>

</body>
</html>